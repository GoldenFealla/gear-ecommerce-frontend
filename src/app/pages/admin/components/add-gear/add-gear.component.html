@let vm = (vm$ | async)!;

<div hlmCard>
    <div hlmCardHeader>
        <h2 hlmCardTitle class="text-2xl">
            <div class="flex flex-row items-center justify-between">
                <span>Add Gear</span>
            </div>
        </h2>
    </div>
    <div hlmCardContent>
        <form [formGroup]="addGearForm" action="">
            <ng-container [ngTemplateOutlet]="imageField"></ng-container>
            <text-form-field [control]="addGearForm.controls.name" label="Name"> </text-form-field>
            <ng-container [ngTemplateOutlet]="gearTypeField"></ng-container>
            <text-form-field [control]="addGearForm.controls.brand" label="Brand"> </text-form-field>
            <number-form-field [control]="addGearForm.controls.price" label="Price" > </number-form-field>
            <number-form-field [control]="addGearForm.controls.discount" label="Discount" > </number-form-field>
            <number-form-field [control]="addGearForm.controls.quantity" label="Quantity" > </number-form-field>
            <ng-container [ngTemplateOutlet]="displayError"></ng-container>
        </form>
        <div class="flex flex-row items-center justify-end h-10">
            <button hlmBtn (click)="handleOnAdd()">
                @if(vm.creating) {
                    <hlm-spinner class="w-5 h-5" />
                } @else { 
                    Add 
                }
            </button>
        </div>
    </div>
</div>

<ng-template #imageField>
    <div class="flex flex-col sm:items-center sm:grid sm:grid-cols-10 gap-1 mt-2">
        <label hlmLabel for="image-field" class="text-left sm:text-right sm:col-span-2 mr-2"
            >Image: </label
        >
        <input
            hlmInput
            id="image-field"
            type="file"
            class="col-span-8"
            (change)="handleOnImageFileChange($any($event.target))"
        />
    </div>
    @if (imageReview) {
        <div class="flex flex-col sm:items-center sm:grid sm:grid-cols-10 gap-1 mt-2">
            <label hlmLabel class="text-left sm:text-right sm:col-span-2 mr-2"
                >Review: </label
            >
            <img
                id="image-review"
                class="col-span-8 max-h-40"
                [src]="imageReview"
            />
        </div>
    }
    <div class="sm:items-center sm:grid sm:grid-cols-10 gap-1 mb-2 min-h-6">
        @let i = addGearForm.controls.image;

        <div class="text-right col-span-2">
            <span></span>
        </div>

        @if(i?.invalid && (i?.dirty || i?.touched)) {
        <div class="col-span-8">
            <span class="font-bold text-xs text-destructive">
                @if(i?.hasError("required")) { 
                    This field is required 
                } 
            </span>
        </div>
        }
    </div>
</ng-template>

<ng-template #gearTypeField>
    <div class="flex flex-col sm:items-center sm:grid sm:grid-cols-10 gap-1 mt-2">
        <label
            hlmLabel
            for="gearType"
            class="text-left sm:text-right col-span-2 mr-2"
            >Type*</label
        >
        <div class="col-span-8">
            <brn-select class="inline-block w-full" placeholder="Select gearType" #gearTypeSelect>
                <hlm-select-trigger class="w-full">
                    <hlm-select-value />
                </hlm-select-trigger>
                <hlm-select-content>
                    @for (gearType of gearTypeList; track $index) {
                        <hlm-option [value]="gearType"> {{ gearType }} </hlm-option>
                    }
                </hlm-select-content>
            </brn-select>
        </div>
        
    </div>
    <div class="flex flex-col sm:itemss-center sm:grid sm:grid-cols-10 gap-1 mb-2 min-h-6">
        @let c = addGearForm.controls.type;

        <div class="text-left sm:text-right col-span-2">
            <span></span>
        </div>

        @if(c?.invalid && (c?.dirty || c?.touched)) {
            <div class="col-span-8">
                <span class="font-bold text-xs text-destructive">
                    @if(c?.hasError("required")) { This field is required }
                </span>
            </div>
        }
    </div>
</ng-template>

<ng-template #displayError>
    @if(!vm.success && vm.message) {
    <div hlmAlert variant="destructive" class="mb-5">
        <hlm-icon hlmAlertIcon name="lucideTriangleAlert" />
        <h4 hlmAlertTitle>Error</h4>
        <p hlmAlertDesc>{{ vm.message }}</p>
    </div>
    }
</ng-template>